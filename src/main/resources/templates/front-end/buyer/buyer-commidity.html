<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<th:block th:insert="~{/fragment-head}"></th:block>
</head>

<body>
	<header th:replace="~{/fragment-headerV2}"></header>

	<!-- 	é€™å€‹Scriptç”¢å“å°ˆç”¨ -->
	<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/lightslider/1.1.6/js/lightslider.min.js"></script>

	<!-- ======= Sidebar ======= -->
	<aside th:replace="@{front-end/buyer/aside-buyer}"></aside>

	<main class="main main-layout">

		<div th:each="productImgVO, iterStat : ${productImageList}">
			<!-- 			<a -->
			<!-- 				th:href="@{'/front/seller/product/DBGifProductImgsReader?productImgId=' + ${productImgVO.productImgId}}">link</a> -->
		</div>

		<!-- ## ListItems -->
		<div class="container mt-4 container-commidity-custom py-4">
			<div class="row">
				<div class="col-6">
					<div class="container-fluid mt-2 mb-3">
						<div class="row">
							<div class="card commidity-card-custom">
								<ul id="lightSlider">
									<li
										th:data-thumb="@{/seller/product/DBGifReader} + '?productId=' + ${productVO.productId}">
										<img class="img-fluid"
											th:src="@{/seller/product/DBGifReader} + '?productId=' + ${productVO.productId}"
											style="max-width: 500px; max-height: 500px;"/>
									</li>
									<li th:each="productImgVO, iterStat : ${productImageList}"
										th:data-thumb="@{/seller/product/DBGifProductImgsReader(productImgId=${productImgVO.getProductImgId()})}">
										<img class="img-fluid"
											th:src="@{/seller/product/DBGifProductImgsReader(productImgId=${productImgVO.getProductImgId()})}"
											style="max-width: 500px; max-height: 500px;" />
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="col-6">
					<h1 class="fw-bold" th:text=${productVO.productName}></h1>
					<section class="commidity-details-custom d-flex">
						<h2 class="fw-bold col-5">å•†å“å”®åƒ¹</h2>
						<h2 class="fw-bold col-7 text-userdark" id="price" th:text="'NT$'+${productVO.Price}"></h2>
					</section>

					<section class="commidity-details-custom d-flex">
						<h5 class="fw-bold col-5">åº«å­˜</h5>
						<h5 class="fw-bold col-7" id="stock" th:text=${productVO.productStockQuantity}>50ä»¶</h5>
					</section>

					<section class="commidity-details-custom d-flex">
						<h5 class="fw-bold col-5">æ•¸é‡</h5>
						<h5 class="fw-bold col-7" id="orderNum">
							<input type="number" class="form-control mx-2" id="quantityInput" value="1" min="1"
								style="width: 150px;">
						</h5>
					</section>

				

					<section class="commidity-details-custom d-flex">
						<h5 class="fw-bold col-5">é‹è²»</h5>
						<h5 class="fw-bold col-7" id="orderNum">NT$ 60</h5>
					</section>

					<section class="commidity-details-custom d-flex justify-content-start gap-3">
						<div class="col-auto d-flex">
							<button class="btn btn-collection-custom" onclick="switchFavoritesStatus()">
								<i class="ri-heart-line"></i><i class="ri-heart-fill"
									style="display:none;"></i>&nbsp;&nbsp;åŠ å…¥æ”¶è—
							</button>
							<script>
								// å®šç¾©ä¸€å€‹å‡½æ•¸, æ¯æ¬¡æ“ä½œåŠ å…¥æ”¶è—æŒ‰éˆ•éƒ½åˆ‡æ›æ”¶è—ç‹€æ…‹
								function switchFavoritesStatus() {
									const addToFavoritesBtn = document.querySelector('.btn-collection-custom');
									// å¦‚æœæŒ‰éˆ•å­˜åœ¨
									if (addToFavoritesBtn) {
										// ç²å–å•†å“IDæˆ–å…¶ä»–éœ€è¦çš„è³‡è¨Š
										const currentUrl = window.location.href;
										const productId = currentUrl.match(/\d+$/)[0]; // å¾ç¶²å€ä¸­æŠ“å•†å“ID
										console.log("æˆ‘è¦æ›´æ–°æ”¶è—ç‹€æ…‹çš„productId" + productId);

										// å»ºç«‹ XMLHttpRequest ç‰©ä»¶
										const xhr = new XMLHttpRequest();

										// è¨­å®šè¦ç™¼é€çš„è«‹æ±‚ï¼ŒåŒ…å«å•†å“IDåƒæ•¸
										xhr.open('GET', `/front/buyer/collection/switchState/${productId}`, true);

										// è¨­å®šè«‹æ±‚æˆåŠŸå¾Œçš„å›èª¿å‡½æ•¸
										xhr.onload = function () {
											if (xhr.status >= 200 && xhr.status < 300) {
												// å¾Œç«¯å›å‚³è©²å•†å“æ˜¯å¦å·²ç¶“åŠ å…¥æ”¶è—
												// const responseData = JSON.parse(xhr.responseText);
												const responseData = xhr.responseText;
												console.log("!!é€™å€‹ç¾åœ¨å¾ˆæ€ªå–”!responseData=" + responseData);
												if (responseData === "å·²å°‡å•†å“ç§»å‡ºæ”¶è—" || responseData === "å·²å°‡å•†å“åŠ å…¥æ”¶è—") {
													alert(responseData);
												}
												else {
													alert("è«‹ç™»å…¥æœƒå“¡ä»¥ä½¿ç”¨æ”¶è—èˆ‡å…¶ä»–ä¾¿åˆ©åŠŸèƒ½");
												}

												// é¡¯ç¤ºè·³çª—æç¤ºå›å‚³è¨Šæ¯
												// alert(responseData);
											} else {
												console.error('Request failed with status:', xhr.status);
												alert("æ”¶è—åŠŸèƒ½éŒ¯èª¤");
											}
										};

										// è¨­å®šè«‹æ±‚å¤±æ•—æ™‚çš„å›èª¿å‡½æ•¸
										xhr.onerror = function () {
											console.error('Request failed');
										};

										// ç™¼é€è«‹æ±‚
										xhr.send();
									};

								};


								// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºç»‘å®šäº‹ä»¶å’Œå‘é€è¯·æ±‚
								function checkFavoritesStatus() {
									// æ‰¾åˆ°åŠ å…¥æ”¶è—æŒ‰é’®
									const addToFavoritesBtn = document.querySelector('.btn-collection-custom');
									// å¦‚æœæŒ‰éˆ•å­˜åœ¨, è€Œä¸”è²·å®¶æœ‰ç™»å…¥
									if (addToFavoritesBtn && true) {
										// ç²å–å•†å“IDæˆ–å…¶ä»–éœ€è¦çš„è³‡è¨Š
										const currentUrl = window.location.href;
										const productId = currentUrl.match(/\d+$/)[0]; // å¾ç¶²å€ä¸­æŠ“å•†å“ID
										console.log(productId);

										// å»ºç«‹ XMLHttpRequest ç‰©ä»¶
										const xhr = new XMLHttpRequest();

										// è¨­å®šè¦ç™¼é€çš„è«‹æ±‚ï¼ŒåŒ…å«å•†å“IDåƒæ•¸
										xhr.open('GET', `/front/buyer/collection/product/${productId}`, true);
										console.log("æœ‰èµ°é“ç™¼é€è«‹æ±‚é€™æ­¥");

										// è¨­å®šè«‹æ±‚æˆåŠŸå¾Œçš„å›èª¿å‡½æ•¸
										xhr.onload = function () {
											if (xhr.status >= 200 && xhr.status < 300) {
												// å¾Œç«¯å›å‚³è©²å•†å“æ˜¯å¦å·²ç¶“åŠ å…¥æ”¶è—
												// const responseData = JSON.parse(xhr.responseText);
												const responseData = xhr.responseText;
												console.log("??é‚„æ˜¯ä½ å£æ‰??responseData=" + responseData);
												// æ ¹æ“šå›å‚³çš„ç‹€æ…‹é€²è¡Œç›¸æ‡‰çš„è™•ç†
												if (responseData.trim() === "true") {
													// å•†å“å·²ç¶“åŠ å…¥æ”¶è—ï¼Œé¡¯ç¤ºç›¸æ‡‰çš„æç¤ºæˆ–è™•ç†é‚è¼¯
													console.log('è©²å•†å“å·²ç¶“åœ¨æ‚¨çš„æ”¶è—æ¸…å–®ä¸­ï¼');
													addToFavoritesBtn.innerHTML = '<i class="ri-heart-fill"></i>&nbsp;&nbsp;æ”¶è—ä¸­';
												} else {
													// å•†å“å°šæœªåŠ å…¥æ”¶è—ï¼Œå¯ä»¥åŸ·è¡ŒåŠ å…¥æ”¶è—çš„å‹•ä½œ
													// é€™è£¡å¯ä»¥è§¸ç™¼åŠ å…¥æ”¶è—çš„ç›¸é—œé‚è¼¯
													console.log('å•†å“ä¸æ˜¯ä½ çš„æ”¶è—');
													addToFavoritesBtn.innerHTML = '<i class="ri-heart-line"></i>&nbsp;&nbsp;åŠ å…¥æ”¶è—';
												}
											} else {
												console.error('Request failed with status:', xhr.status);
											}
										};

										// è¨­å®šè«‹æ±‚å¤±æ•—æ™‚çš„å›èª¿å‡½æ•¸
										xhr.onerror = function () {
											console.error('Request failed');
										};

										// ç™¼é€è«‹æ±‚
										xhr.send();
									}
								}

								// åœ¨é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•åŸ·è¡Œä¸€æ¬¡
								document.addEventListener('DOMContentLoaded', checkFavoritesStatus);
							</script>

							<!-- <button class="btn btn-like-custom" style="display: none">
								<i class="ri-heart-fill"></i>&nbsp;&nbsp;å–æ¶ˆæ”¶è—
							</button> -->
						</div>
						<div class="col-auto d-flex">
							<button class="btn btn-shopcart-custom" onclick="addIntoCart()">
								<i class="ri-shopping-cart-2-line"></i>&nbsp;&nbsp;æ”¾å…¥è³¼ç‰©è»Š
							</button>
						</div>
						<script>
							// å®šç¾©ä¸€å€‹å‡½æ•¸, æ¯æ¬¡æ“ä½œåŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ•éƒ½ä¾ç…§æ‰€æŒ‡å®šæ•¸é‡, å°‡è©²å•†å“åŠ å…¥è³¼ç‰©è»Š(å·²æœ‰å‰‡ç–ŠåŠ )
							function addIntoCart() {
								// æŠ“åˆ°æŒ‰éˆ•, é‚„æœ‰æ•¸é‡è¨­å®šçš„æ¬„ä½
								const addToFavoritesBtn = document.querySelector('.btn-shopcart-custom');
								const quantityInput = document.getElementById('quantityInput');
								// å¦‚æœæŒ‰éˆ•å­˜åœ¨ä¸”è¨­å®šæ•¸é‡æ¬„ä½å­˜åœ¨
								if (addToFavoritesBtn && quantityInput) {
									// ç²å–å•†å“IDæˆ–å…¶ä»–éœ€è¦çš„è³‡è¨Š
									const currentUrl = window.location.href;
									const productId = currentUrl.match(/\d+$/)[0]; // å¾ç¶²å€ä¸­æŠ“å•†å“ID
									const productQty = quantityInput.value;
									console.log("æˆ‘è¦åŠ å…¥è³¼ç‰©è»Šçš„æ˜¯productId=" + productId + " ,productQty=" + productQty);

									// æ§‹å»ºè¦å‚³éçš„è³‡æ–™
									const data = {
										productId: productId,
										productQty: productQty
									};

									// ç™¼é€ POST è«‹æ±‚
									fetch('/front/buyer/cart/addToCartFromProduct', {
										method: 'POST',
										headers: {
											'Content-Type': 'application/json'
										},
										body: JSON.stringify(data)
									})
										.then(response => response.json())
										.then(data => {
											console.log('åŠ å…¥è³¼ç‰©è»ŠæˆåŠŸ:', data);
											alert('å·²ç¶“åŠ å…¥è³¼ç‰©è»Š');
										})
										.catch(error => {
											console.error('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
											alert('è«‹ç™»å…¥æœƒå“¡ä»¥ä½¿ç”¨è³¼ç‰©è»Šèˆ‡å…¶ä»–ä¾¿åˆ©åŠŸèƒ½!');
										});
								};
							};
						</script>

						<div class="col-auto d-flex">
							<button class="btn btn-userdark text-white" id="buyItNow-btn">
								&nbsp;&nbsp;ç›´æ¥è³¼è²·</button>
						</div>
						<script>
							$(document).ready(function () {
								$('#buyItNow-btn').click(function () {
									console.log("æ¸¬è©¦è¨Šæ¯:æœ‰ç¶åˆ°ç›´æ¥è³¼è²·æŒ‰éˆ•");
									// å°‡å•†å“è³‡è¨Šå°è£æˆè³‡æ–™, è½‰æˆJSONå­—ä¸²
									let goingBuyProduct = new Map();
									let keyName = "keyName";
									const currentUrl = window.location.href;
									const urlReturn = window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/front/buyer/order_checkout';
									let productId = currentUrl.match(/\d+$/)[0];
									let productQty = document.getElementById('quantityInput').value;
									goingBuyProduct.set(keyName, [{ "productId": productId, "productQty": productQty }]);
									console.log("æ¸¬è©¦è¨Šæ¯:goingBuyProduct=" + goingBuyProduct);
									const obj = Object.fromEntries(goingBuyProduct);
									const GoingBuyProductJsonStr = JSON.stringify(obj);
									console.log("æ¸¬è©¦è¨Šæ¯:GoingBuyProductJsonStr" + GoingBuyProductJsonStr);

									// ä½¿ç”¨ jQuery AJAX é€å‡º POST è«‹æ±‚
									$.ajax({
										url: '/front/buyer/buyProductWithoutCart', // æ›¿æ›æˆä½ çš„ POST è«‹æ±‚ URL
										type: 'POST',
										contentType: 'application/json', // è¨­ç½®è«‹æ±‚header
										data: GoingBuyProductJsonStr, // è³‡æ–™è½‰JSON JSON æ ¼å¼
										success: function (responseData) {
											window.location.href = urlReturn;
											console.log(responseData);
											console.log('POST è¯·æ±‚æˆåŠŸ');
										},
										error: function (xhr, status,
											error) {
											// è¯·æ±‚å¤±è´¥å¤„ç†
											console.error('POST è¯·æ±‚å¤±è´¥:',
												error);
											console.log('ç‹€æ…‹:', status);
											console.log('å›æ‡‰å…§å®¹:',
												xhr.responseText);
										}
									});
								});
							});
						</script>
					</section>
				</div>
			</div>
		</div>
		<div class="container mt-4 container-commidity-custom">
			<div class="row">
				<div class="col-12 bg-user">
					<h5 class="d-flex mb-0 py-2">å•†å“æè¿°</h5>
				</div>
			</div>

			<div class="row py-3">
				<div class="col-12 text-wrap commidity-desp-custom" id="description"
					th:text=${productVO.productDetails}></div>

				<div>âš ï¸ç‚ºäº†è®“å„ä½æœ‰æ„‰å¿«çš„æ¶ˆè²»ç¶“é©— âš ï¸è³¼è²·å‰å‹™å¿…è©³ç´°é–±è®€ â—‡â—†â—‡â—†â—‡â—†â—‡â—†â—‡ä¸‹å–®é ˆçŸ¥â—‡â—†â—‡â—†â—‡â—†â—‡â—†â—‡
					ğŸ»æœ¬è³£å ´èƒ½ä¸‹å–®çš„å•†å“å¤§éƒ¨ä»½éƒ½æ˜¯ç¾è²¨ å¦‚é‡ç¼ºè²¨æœƒå³æ™‚å‘ŠçŸ¥ ğŸ»å•†å“æœ‰ä»»ä½•å•é¡Œè«‹å…ˆèŠèŠåæ‡‰ æˆ‘å€‘æœƒå³æ™‚è™•ç†ï¼Œåˆ‡å‹¿ä»¥è©•åƒ¹ä½œç‚ºæºé€š
					ğŸ»å‡ºè²¨æ™‚é–“:å‘¨ä¸€è‡³å‘¨äº”ï¼Œå…­æ—¥åŠåœ‹å®šå‡æ—¥æ˜¯åº—ä¼‘æ—¥ ğŸ»å°ç£å‡ºè²¨ï¼Œéæµ·å¤–è³£å®¶ï¼Œå¯„å‡º3~4å€‹å·¥ä½œå¤©å³åˆ°é–€å¸‚ ğŸ»æœ¬è³£å ´ç”±è¦çš®ä»£é–‹é›»å­ç™¼ç¥¨
					éœ€è¦çµ±ç·¨çš„æœ‹å‹è¨˜å¾—åœ¨çµå¸³æ­¥é©Ÿä¸­é¸å¡« æœ‰ä»»ä½•ç™¼ç¥¨å•é¡Œéƒ½å¯ä»¥ç›´æ¥è©¢å•è¦çš®å®¢æœ</div>

			</div>
		</div>

		<div class="container mt-4 container-commidity-custom">
			<div class="row">
				<div class="col-12 bg-user">
					<h5 class="d-flex mb-0 py-2">å•†å“è©•åƒ¹</h5>
				</div>
			</div>

			<div class="row py-3">
				<div class="col-12 d-flex commidity-rate-custom" id="description">
					<div class="d-flex align-items-center justify-content-end user-icon">
						<i class="ri-user-fill" style="font-size: 30px">&nbsp;&nbsp;</i>
					</div>
					<div class="d-flex flex-column user-comment">
						<h5 class="comment-account fw-bold mb-0">account1</h5>
						<div class="comment-star d-flex">
							<i class="bi bi-star-fill text-userdark"></i> <i class="bi bi-star"></i> <i
								class="bi bi-star"></i> <i class="bi bi-star"></i> <i class="bi bi-star"></i>
						</div>
						<div class="comment-time">2023-01-1</div>
					</div>
					<div class="col-3 user-commentarea d-flex text-wrap">
						SSSSSSSSSSSS SSSSSSSSS</div>
				</div>
				<div class="col-12 d-flex commidity-rate-custom" id="description">
					<div class="d-flex align-items-center justify-content-end user-icon">
						<i class="ri-user-fill" style="font-size: 30px">&nbsp;&nbsp;</i>
					</div>
					<div class="d-flex flex-column user-comment">
						<h5 class="comment-account fw-bold mb-0">account1</h5>
						<div class="comment-star d-flex">
							<i class="bi bi-star-fill text-userdark"></i> <i class="bi bi-star"></i> <i
								class="bi bi-star"></i> <i class="bi bi-star"></i> <i class="bi bi-star"></i>
						</div>
						<div class="comment-time">2023-01-1</div>
					</div>
					<div class="col-3 user-commentarea d-flex text-wrap">
						SSSSSSSSSSSS SSSSSSSSS</div>
				</div>
			</div>
		</div>
	</main>

	<!-- End Footer -->
	<div th:replace="~{/fragment-footer}"></div>
	<div th:replace="~{/fragment-js}"></div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			$("#lightSlider").lightSlider({
				gallery: true,
				item: 1,
				loop: true,
				slideMargin: 50,
				thumbItem: 6
			});
		});

		function decrementQuantity() {
			var quantityInput = document.getElementById("quantityInput");
			if (quantityInput.value > 1) {
				quantityInput.value--;
			}
		}

		function incrementQuantity() {
			var quantityInput = document.getElementById("quantityInput");
			quantityInput.value++;
		}
	</script>
</body>

</html>