<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

<th:block th:insert="~{/fragment-head}"></th:block>
<!-- <th:block th:insert="~{/fragment-datatableCss}"></th:block> -->
<style type="text/css">
.hide {
	display: none;
}
</style>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>
	<!-- ======= Header ======= -->
	<header class="fixed-top">
		<nav
			class="navbar navbar-expand navbar-expand-sm navbar-light bg-user">
			<div class="container-fluid">
				<div class="collapse navbar-collapse d-flex justify-content-between"
					id="navbarSupportedContent">
					<!-- Start NavBar  -->
					<!-- NavBar--LeftSide  -->
					<ul class="navbar-nav me-auto mb-2">
						<li class="nav-item d-flex align-items-center toggle-sidebar-btn">
							<i class="bi bi-list"></i> <a
							class="nav-link cancel-default-behavior" aria-current="page"
							href="#">選單</a>
						</li>
						<li class="nav-item d-flex align-items-center"><a
							class="nav-link active" aria-current="page" href="#">電子商城</a></li>
						<li class="nav-item"><a class="nav-link"
							href="seller-login.html">賣家中心</a></li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/article/listAll}">論壇</a></li>
					</ul>

					<!-- NavBar--RightSide  -->
					<ul class="navbar-nav ms-auto mb-2">

						<!-- 測試進入後台入口 -->
						<li class="nav-item"><a class="nav-link active"
							aria-current="page" href="#">註冊</a></li>
						<li class="nav-item"><a class="nav-link" href="#">登入</a></li>
					</ul>
				</div>
			</div>
		</nav>
		<!-- End NavBar  -->

		<!-- Start SearchBar  -->
		<div class="container-fluid bg-user search-container-custom">
			<div class="row">
				<!-- Start SearchBar-Logo  -->
				<div
					class="col-auto d-none d-lg-block logo-container-height d-flex align-items-end">
					<img th:src="@{/image/Medium.png}" class="img-logo-custom" alt=""
						srcset="" />
				</div>
				<!-- End SearchBar-Logo  -->

				<!-- Start SearchBar-Input  -->
				<div
					class="col d-flex searchItem flex-column search-item-container-custom">
					<form class="form-inline w-100" method="post"
						th:action="@{petdraw}">
						<div class="row py-2 search-row-custom w-100 pe-2">
							<div class="col">
								<input class="form-control mr-sm-2 w-100 search-input-custom"
									type="search" placeholder="請在此進行文章搜索" aria-label="Search"
									name="searchText" />
							</div>
							<div class="col-auto">
								<button class="btn btn-user search-button-custom d-flex"
									type="submit">
									<i class="me-2 ri-search-line"></i>
									<div class="col-auto d-none d-md-block">Search</div>
								</button>
							</div>
						</div>
					</form>
					<div class="my-2 keyword-container-custom">
						<span class="badge rounded-pill keyword-item-custom">寵物床</span> <span
							class="badge rounded-pill keyword-item-custom">玩具</span>
					</div>
				</div>
				<!-- End SearchBar-Input  -->

			</div>
		</div>
	</header>
	<!-- End NavBar  -->
	<!-- ======= Sidebar ======= -->
	<aside th:replace="front-end/article/aside-forum.html"></aside>
	<!-- ======= Main ======= -->
	<main class="main main-layout-seller">
		<div class="seller-container">
			<div class="pagetitle">

				<form th:action="@{/front/forum/petdraw/othersparing}" method="post" th:object="${petDrawVO}"
					enctype="multipart/form-data" th:if="${petDrawVO.isMemberLike}">

					<div
						class="atm_mk_stnw88 atm_tk_1u1b7xl atm_fq_1ssbidh atm_tr_zr6sja atm_3f_1n6thub atm_5j_1fwxnve atm_ks_15vqwwr a1af3bqe">
						<div
							class="atm_e2_uuw12j atm_vy_uuw12j atm_ks_15vqwwr atm_mk_h2mmj6 atm_2d_16vjel sofhfzb">
							<div
								class="atm_9s_1bgihbq atm_p5gc90_1wugsn5 atm_17vq4o2_1wugsn5 atm_1188u0s_1iio4e3 atm_2pzl0u_1be5f4n atm_wnvm1g_1q5117e atm_12681ec_1ulexfb atm_1wb4qx2_1b29qit atm_16kx3jw_1wugsn5 atm_18hzl3q_h2mmj6 atm_ry921k_zt8pdg atm_sjz5bo_1ulexfb i1c7ubre"
								style="--5qsozf: 60vh; --aspect-ratio: 0.75/1; --max-width: 500px; --max-height: 600px;">
								<img class="atm_jp_1dfr4pj atm_1we33yh_1osqo2v a1kf6kxe" alt=""
									src="https://photos.dcard.tw/memberPhotos/96f51f97-0d8e-41fd-b965-0c34e07908f0"
									width="500" height="600" loading="lazy">
							</div>
						</div>
					</div>

					<div>
						<label>抽卡編號:</label> <input type="text" th:field="*{petDrawId}"
							style="border: 0px; font-weight: bold;" readonly /><br />
					</div>

					<div>
						<label>我的會員編號:</label> <input type="text"
							th:field="*{memberPairId}"
							style="border: 0px; font-weight: bold;" readonly /><br />
					</div>

					<div>
						<label>他的會員編號:</label> <input type="text" th:field="*{memberId}"
							style="border: 0px; font-weight: bold;" readonly /><br />
					</div>

					<div class="hide">
						<label>抽卡時間:</label> <input type="date" th:field="*{petDrawTime}"
							readonly /><br />
					</div>
					<div class="hide">
						<label>他喜歡你的時間:</label> <input type="date"
							th:field="*{memberResTime}" readonly /><br />
					</div>
					<div class="hide">
						<label>他喜歡你嗎:</label> <input type="text"
							th:field="*{isMemberLike}" readonly /><br />
					</div>

					<div>
						<!-- 					喜歡=1不喜歡=0 -->
						<div>
							<button type="submit" name="isMemberPairLike"
								th:value="${petDrawVO.isMemberPairLike == null ? 0 : petDrawVO.isMemberPairLike}"
								class="modern-button">我不要</button>
							<button type="submit" name="isMemberPairLike"
								th:value="${petDrawVO.isMemberPairLike == null ? 1 : petDrawVO.isMemberPairLike}"
								class="modern-button">我接受</button>
						</div>

					</div>

				</form>

				<div th:if="${petDrawVO.isMemberLike == false}">
					<h1 style="margin-top: 30px;">沒人喜歡你ㄏㄏ</h1>
				</div>

			</div>
		</div>
	</main>
	<!-- End Main -->

	<!-- ======= Footer ======= -->
	<footer class="footer footer-layout">
		<div
			class="row row-cols-1 row-cols-sm-2 row-cols-md-4 pt-5 border-top footer-container-custom text-white">
			<div class="col d-none d-sm-block p-sm-2 px-5 px-sm-5 px-md-0"></div>

			<div class="col p-sm-2 px-5 px-sm-5 px-md-0">
				<h5 class="mb-3">關於我們</h5>
				<ul class="nav flex-column">
					<li class="nav-item mb-2"><a href="#"
						class="nav-link p-0 text-body-secondary">人才招募</a></li>
					<li class="nav-item mb-2"><a href="#"
						class="nav-link p-0 text-body-secondary">E狗簡介</a></li>
				</ul>
			</div>

			<div class="col p-sm-2 px-5 px-sm-5 px-md-0">
				<h5 class="mb-3">常見問題</h5>
				<ul class="nav flex-column">
					<li class="nav-item mb-2"><a href="#"
						class="nav-link p-0 text-body-secondary">聯絡E狗</a></li>
					<li class="nav-item mb-2"><a href="#"
						class="nav-link p-0 text-body-secondary">Q&A</a></li>
				</ul>
			</div>
		</div>
		<div class="row footer-container-custom">
			<div class="col-3"></div>

			<div class="col-auto">
				<a href="/"
					class="d-flex align-items-center mb-3 link-body-emphasis text-decoration-none">
					<svg class="bi" width="32" height="32" fill="currentColor">
                        <use xlink:href="bootstrap-icons.svg#heart-fill" />
                    </svg>
				</a>
				<p class="text-body-secondary">新加坡商CatTom有限公司台灣分公司 統一編號：00000000
					© 2023 CatTom.版權所有。</p>
			</div>
		</div>
	</footer>
	<!-- End Footer -->

	<!-- Vendor JS Files -->
	<div th:replace="~{/fragment-js}"></div>
	<div th:replace="~{/fragment-datatableJs}"></div>

	<script>
        let hasDrawnCard = false;

        function drawCard() {
            // 檢查是否已經抽過卡
            if (!hasDrawnCard) {
                // 使用 Ajax 或其他方式從後端獲取會員抽卡的數據
                // 這裡假設你有一個名為 '/api/member/draw' 的 API
                fetch('/api/member/draw')
                    .then(response => response.json())
                    .then(data => {
                        // 處理從後端獲取的會員抽卡數據
                        handleMemberDraw(data);
                        showCountdown();  // 在抽卡後顯示倒數計時
                    })
                    .catch(error => console.error('Error fetching member draw data:', error));
            }
        }

        
        
        
        
        
        
        function handleMemberDraw(memberData) {
        	// 在這裡處理從後端獲取的會員抽卡數據
            const cardContainer = document.getElementById('cardContainer');
            const memberProfile = document.getElementById('memberProfile');
            const memberPhoto = document.getElementById('memberPhoto');
            const memberInfo = document.getElementById('memberInfo');

            // 更新會員照片
            memberPhoto.src = 'data:image/png;base64,' + memberData.petImg;
            memberPhoto.alt = `Member: ${memberData.memberName}`;
            
            // 更新會員個人資料
            memberInfo.innerHTML = `<p>ID: ${memberData.memberId}</p>
                                <p>Name: ${memberData.memberName}</p>
                                <p>Email: ${memberData.memberEmail}</p>
                                <p>Phone: ${memberData.memberPhone}</p>
                                <!-- 其他資料可自行添加 -->
                                <div style="height: 30px;"></div>
                                <button onclick="showChatWindow()">聊天</button>`; // 添加一個聊天按鈕

                                // 顯示會員照片和個人資料
                                memberProfile.style.display = 'block';

            // 創建一個圖片元素
            const image = document.createElement('img');
            image.src = 'data:image/png;base64,' + memberData.petImg; // 使用 Base64 編碼的圖片資料
            image.alt = `Pet: ${memberData.petName}`;
            image.style.width = '320px';  // 設置圖片寬度為 320 像素
            image.style.height = '320px'; // 設置圖片高度為 320 像素

            // 創建一個文字元素
            const text = document.createElement('p');
            text.textContent = `ID: ${memberData.memberId}\nName: ${memberData.memberName}\nPet: ${memberData.petName}`;
            // 如果存在 petDraw 欄位，顯示相關信息
            if (memberData.petDraw) {
                const mainInfo = document.createElement('p');
                mainInfo.textContent = `Main: ${memberData.petDraw.memberMain.memberName}`;

                const pairInfo = document.createElement('p');
                pairInfo.textContent = `Pair: ${memberData.petDraw.memberPair.memberName}`;

                const isMemberLikeInfo = document.createElement('p');
                isMemberLikeInfo.textContent = `Is Member Like: ${memberData.petDraw.isMemberLike}`;

                const isMemberPairLikeInfo = document.createElement('p');
                isMemberPairLikeInfo.textContent = `Is Member Pair Like: ${memberData.petDraw.isMemberPairLike}`;

                card.appendChild(mainInfo);
                card.appendChild(pairInfo);
                card.appendChild(isMemberLikeInfo);
                card.appendChild(isMemberPairLikeInfo);
            }

            // 將圖片和文字添加到卡片中
            card.appendChild(image);
            card.appendChild(text);

            // 將卡片添加到 cardContainer 中
            cardContainer.appendChild(card);

            hasDrawnCard = true; // 更新抽卡狀態
        }

        function showCountdown() {
            const countdownElement = document.getElementById('countdown');
            const drawButton = document.getElementById('drawButton');

            // 重新啟用抽卡按鈕
            drawButton.disabled = false;

            // 顯示倒數計時
            countdownElement.style.display = 'block';

            // 啟動倒數計時器
            startCountdown();
        }

        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            const drawButton = document.getElementById('drawButton');

            let countdownSeconds = localStorage.getItem('countdownSeconds') || 86400; // 從localStorage讀取剩餘時間，預設為一天

            function updateCountdown() {
                const hours = Math.floor(countdownSeconds / 3600);
                const minutes = Math.floor((countdownSeconds % 3600) / 60);
                const seconds = countdownSeconds % 60;

                countdownElement.textContent = `明天可抽卡倒數：${hours} 小時 ${minutes} 分鐘 ${seconds} 秒`;

                if (countdownSeconds === 0) {
                    drawButton.disabled = false; // 啟用按鈕
                    countdownElement.textContent = ''; // 清空倒數計時顯示
                } else {
                    countdownSeconds--;
                    localStorage.setItem('countdownSeconds', countdownSeconds); // 將剩餘時間存儲到localStorage
                    setTimeout(updateCountdown, 1000); // 每秒更新一次
                }
            }

            updateCountdown();
        }

        // 在頁面載入時檢查localStorage中是否有剩餘時間，如果有，更新按鈕狀態
        window.onload = function () {
            const drawButton = document.getElementById('drawButton');
            const storedSeconds = localStorage.getItem('countdownSeconds');

            if (storedSeconds && storedSeconds > 0) {
                drawButton.disabled = true; // 禁用按鈕
                startCountdown();
            }
        };

        function resetCardDraw() {
            // 重置抽卡狀態
            hasDrawnCard = false;

            // 清空會員資料區塊
            const memberProfile = document.getElementById('memberProfile');
            memberProfile.style.display = 'none';

            // 清空卡片容器
            const cardContainer = document.getElementById('cardContainer');
            cardContainer.innerHTML = '';

            // 隱藏倒數計時器
            const countdownElement = document.getElementById('countdown');
            countdownElement.style.display = 'none';

            // 啟用抽卡按鈕
            const drawButton = document.getElementById('drawButton');
            drawButton.disabled = false;

            // 清空localStorage中的倒數時間
            localStorage.removeItem('countdownSeconds');
        }
    </script>

</body>


</html>


